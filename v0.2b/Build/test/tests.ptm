CALL init_common_graphics
GOTO test_sprite_tile_collision

#==============================================================================
#	String string split and join
	test_sprite_tile_collision:
#==============================================================================
TILE.NEW 1, 1
SPR.NEW "smiley"
SPR.BUF "smiley", default
SPR.POS "smiley", 0, 0
SPR.SHOW "smiley"

TILE.NEW 2, 7
TILE.SETP "type", "pellet"
RECT 5, 4, 20, 10

loop1:
	IF.KEY "RIGHT"
		SPR.MOVE "smiley", 1, 0
	ENDIF
	IF.KEY "LEFT"
		SPR.MOVE "smiley", -1, 0
	ENDIF
	IF.KEY "DOWN"
		SPR.MOVE "smiley", 0, 1
	ENDIF
	IF.KEY "UP"
		SPR.MOVE "smiley", 0, -1
	ENDIF
	SPR.GETX "smiley", x
	SPR.GETY "smiley", y
	DIV x, x, 8
	DIV y, y, 8
	DELR 0, 0, 32, 1
	LOCATE x, y
	GET
	TILE.GETP "type", type
	DEL
	LOCATE 0, 0
	PRINTF "({%x} {%y}) {%type}"
	UPDATE
	GOTO loop1

#==============================================================================
#	String string split and join
	test_split_join:
#==============================================================================
VAR fruits, "apple ,orange, lemon, tomato "
STR.SPLIT fruit_arr, fruits, ","
ARR.FOR fruit_arr, fruit
	MSGBOX fruit
NEXT
STR.JOIN fruit_arr, joined_fruit_arr, " & "
MSGBOX joined_fruit_arr
EXIT

#==============================================================================
#	True/false conditional execution flow
	test_boolean:
#==============================================================================
VAR ok, "Hello"
IF.TRUE ok
	MSGBOX "Ok!"
ENDIF
IF.FALSE ok
	MSGBOX "Not ok..."
ENDIF

EXIT

#==============================================================================
#	Sprintf
	test_sprintf:
#==============================================================================
VAR x, 12345
VAR y, "Hello"
SPRINTF msg, "Variables are: x={%x} y={%y}"
MSGBOX msg
EXIT

#==============================================================================
#	Tile search
	test_search:
#==============================================================================
TILE.NEW 'a', 2, 3
TILE.SETP "type", "letter-a"
LOCATE 10, 10
PUT
TILE.NEW 'b', 4, 5
TILE.SETP "some-tag"
LOCATE 13, 15
PUT

FIND "type=letter-a", search_result, found_x, found_y
MSGBOX search_result
IF.TRUE search_result
	SPRINTF msg, "Letter-a found at: x{%found_x} y{%found_y}"
	MSGBOX msg
ENDIF
IF.FALSE search_result
	MSGBOX "Letter-a not found"
ENDIF

HALT

#==============================================================================
#	Transparency
	test_transparency:
#==============================================================================
BUF.BCOL default, 8

TILE.NEW 'a', 2, 3
TILE.ADD 'b', 3, 2
LOCATE 10, 10
PUT

TILE.NEW 'a', 4
TILE.ADD 'b', 5
LOCATE 12, 10
PUT

HALT

#==============================================================================
#	Formatted string printing
	test_printf:
#==============================================================================
VAR x, 123
LOCATE 1, 1
PRINTF "Hello {f2}{%x}{/f} {b3}{f6}World{/f}{/b}\nNew line, char: {c120}"
HALT

#==============================================================================
#	Various different tilebuffer and sprite tests
	test_misc:
#==============================================================================
BUF.BCOL default, 8
BUF.NEW buf_1, 1, 20, 20, 1
BUF.VIEW buf_1, 10, 10, 100, 100
BUF.BCOL buf_1, 4
BUF.SHOW buf_1

BUF.NEW buf_2, 1, 20, 20, 2
BUF.VIEW buf_2, 60, 60, 160, 160
BUF.BCOL buf_2, 5
BUF.SHOW buf_2

BUF.SEL buf_1
CALL draw_stuff
BUF.SEL buf_2
CALL draw_stuff

TILE.NEW 1, 0
SPR.NEW "smiley"
SPR.BUF "smiley", buf_1
SPR.POS "smiley", 0, 0
SPR.SHOW "smiley"

TILE.NEW 1, 2
SPR.NEW "enemy"
SPR.POS "enemy", 150, 50
SPR.SHOW "enemy"

VAR move_speed, 1
NEG move_speed_neg, move_speed

loop:
	SPR.GETX "smiley", prev_x
	SPR.GETY "smiley", prev_y

	IF.KEY "RIGHT"
		#BUF.SCRL buf_1, 1, 0
		SPR.MOVE "smiley", move_speed, 0
	ENDIF
	IF.KEY "LEFT"
		#BUF.SCRL buf_1, -1, 0
		SPR.MOVE "smiley", move_speed_neg, 0
	ENDIF
	IF.KEY "UP"
		#BUF.SCRL buf_1, 0, -1
		SPR.MOVE "smiley", 0, move_speed_neg
	ENDIF
	IF.KEY "DOWN"
		#BUF.SCRL buf_1, 0, 1
		SPR.MOVE "smiley", 0, move_speed
	ENDIF
	
	INKEY key

	IF.EQ key, 'q'
		BUF.CLS buf_1
	ENDIF
	IF.EQ key, 'w'
		BUF.CLS buf_2
	ENDIF
	IF.EQ key, 'e'
		BUF.TOGL buf_1
	ENDIF
	IF.EQ key, 'r'
		BUF.TOGL buf_2
	ENDIF
	IF.EQ key, 'x'
		RESET
	ENDIF
	
	SPR.HIT collision, "smiley", "enemy"
	IF.EQ collision, 1
		SPR.POS "smiley", prev_x, prev_y
	ENDIF
	
	UPDATE
	GOTO loop
	
draw_stuff:
	LOCATE 0, 0
	TILE.NEW 'a', 2, 3
	TILE.ADD 'b', 3, 2
	PUT
	LOCATE 1, 0
	TILE.NEW 1, 3, 2
	PUT
	LOCATE 0, 1
	TILE.NEW 1, 3, 2
	PUT
	LOCATE 11, 11
	TILE.NEW 1, 2, 3
	PUT
	LOCATE 2, 5
	COLOR 6, 7
	PRINT "Hello World!"
	PUTC '@'
	LOCATE 2, 6
	FCOL 0
	PRINT "Hello World!"
	LOCATE 2, 7
	BCOL 2
	PRINT "Hello World!"
	RET

#==============================================================================
#	Blinking text
	test_print_add:
#==============================================================================
ANIM 90
TRON
LOCATE 1, 1
COLOR 1, 0
PRINT "Hello World!"
LOCATE 1, 1
COLOR 0, 0
PRINT.ADD "Hello World!"
HALT

#==============================================================================
#	Text input
	test_text_input:
#==============================================================================
LOCATE 1, 1
COLOR 3, 4
INPUT name, 10
LOCATE 1, 2
PRINT name
HALT
	
#==============================================================================
#	Common graphics (used in all tests)
	init_common_graphics:
#==============================================================================
WINDOW 360, 200, 4, 1

CHR 1, "1111111110000001101001011000000110100101100110011000000111111111"
CHR 2, "0000000000000000000110000011110000111100000110000000000000000000"

PAL 0, &h101010
PAL 1, &hf0f0f0
PAL 2, &hff0000
PAL 3, &h00ff00
PAL 4, &h0000ff
PAL 5, &h00ffff
PAL 6, &hff00ff
PAL 7, &hffff00
PAL 8, &h404040

RET
